<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Covidestim • covidestim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using Covidestim">
<meta property="og:description" content="covidestim">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">covidestim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1.0000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/covidestim_vignette.html">Using Covidestim</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="covidestim_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Covidestim</h1>
                        <h4 class="author">Melanie H. Chitwood, Marcus Russi</h4>
            
      
      
      <div class="hidden name"><code>covidestim_vignette.Rmd</code></div>

    </div>

    
    
<p><strong>This vignette is intended to guide users through running the covidestim model and accessing the model output.</strong></p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">covidestim</span>)</pre></body></html></div>
<div id="running-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-model" class="anchor"></a>Running the model</h2>
<div id="data" class="section level3">
<h3 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h3>
<p>Will we demonstrate how to use the covidestim paackage using data from the <a href="https://www.mass.gov/info-details/archive-of-covid-19-cases-in-massachusetts">Massachusetts Department of Public Health</a> Users can use case and/or death data with the model. Data on the fraction of tests with a positive results may also be used; we strongly recommend users smooth fraciton positive data using a moving average or spline. Each data type should be entered as its own dataframe with two columns: a column called ‘date’ and a column called ‘observation.’</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df.cases</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   date       observation</span>
<span class="co">#&gt;   &lt;date&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2020-03-01           1</span>
<span class="co">#&gt; 2 2020-03-02           0</span>
<span class="co">#&gt; 3 2020-03-03           1</span>
<span class="co">#&gt; 4 2020-03-04           2</span>
<span class="co">#&gt; 5 2020-03-05           8</span>
<span class="co">#&gt; 6 2020-03-06          14</span></pre></body></html></div>
</div>
<div id="generate-a-model-configuration" class="section level3">
<h3 class="hasAnchor">
<a href="#generate-a-model-configuration" class="anchor"></a>Generate a model configuration</h3>
<p>Inpute data and model run options are summarized into a covidestim configuration with the funciton call <a href="%5Ccode%7B?covidestim%7D"><code><a href="../reference/covidestim.html">covidestim()</a></code></a>. Users must specify the number of days of data in the input data. More information on data formating can be found <a href="%5Ccode%7B?input_cases%7D">here</a>. Calling <code><a href="../reference/covidestim.html">covidestim()</a></code> will produce a summary of model run conditions, priors, and data inputs.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/covidestim.html">covidestim</a></span>(<span class="kw">ndays</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">df.cases</span>))
<span class="co">#&gt; Covidestim Configuration:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Seed:    42</span>
<span class="co">#&gt; Chains:  3</span>
<span class="co">#&gt; Iterations:  1500</span>
<span class="co">#&gt; Warmup runs: 1200</span>
<span class="co">#&gt; Priors: Valid</span>
<span class="co">#&gt; ndays:   103</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Priors:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  log_new_inf_0_mu    0</span>
<span class="co">#&gt;  log_new_inf_0_sd    10</span>
<span class="co">#&gt;  deriv1_log_new_inf_sd   0.5</span>
<span class="co">#&gt;  deriv2_log_new_inf_sd   0.05</span>
<span class="co">#&gt;  p_sym_if_inf    [alpha] 44.9</span>
<span class="co">#&gt;  p_sym_if_inf    [beta]  9.9</span>
<span class="co">#&gt;  p_sev_if_sym    [alpha] 11.9</span>
<span class="co">#&gt;  p_sev_if_sym    [beta]  47.7</span>
<span class="co">#&gt;  p_die_if_sev    [alpha] 3</span>
<span class="co">#&gt;  p_die_if_sev    [beta]  97</span>
<span class="co">#&gt;  p_die_if_sym    [alpha] 1.12</span>
<span class="co">#&gt;  p_die_if_sym    [beta]  85.1</span>
<span class="co">#&gt;  inf_prg_delay   [shape] 5.202</span>
<span class="co">#&gt;  inf_prg_delay   [rate]  0.946</span>
<span class="co">#&gt;  sym_prg_delay   [shape] 5.147</span>
<span class="co">#&gt;  sym_prg_delay   [rate]  0.468</span>
<span class="co">#&gt;  sev_prg_delay   [shape] 2.383</span>
<span class="co">#&gt;  sev_prg_delay   [rate]  0.27</span>
<span class="co">#&gt;  cas_rep_delay_shp   [alpha] 2.2</span>
<span class="co">#&gt;  cas_rep_delay_shp   [beta]  1</span>
<span class="co">#&gt;  die_rep_delay_shp   [alpha] 2.2</span>
<span class="co">#&gt;  die_rep_delay_shp   [beta]  1</span>
<span class="co">#&gt;  p_diag_if_sym   [alpha] 2</span>
<span class="co">#&gt;  p_diag_if_sym   [beta]  2</span>
<span class="co">#&gt;  p_diag_if_sev   [alpha] 1.5</span>
<span class="co">#&gt;  p_diag_if_sev   [beta]  1</span>
<span class="co">#&gt;  weekend_eff [alpha] 2</span>
<span class="co">#&gt;  weekend_eff [beta]  2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Inputs:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  [ ❌ ]   Cases</span>
<span class="co">#&gt;  [ ❌ ]   Deaths</span>
<span class="co">#&gt;  [ ❌ ]   Fraction positive</span></pre></body></html></div>
<p>Notice that what we input is <strong>not</strong> a valid model configuration because it does not contain data! Each dataframe must be added to the covidestim call using calls <a href="%5Ccode%7B?input_cases%7D"><code><a href="../reference/input_cases.html">input_cases()</a></code></a>, <a href="%5Ccode%7B?input_deaths%7D"><code><a href="../reference/input_cases.html">input_deaths()</a></code></a>, and <a href="%5Ccode%7B?input_fracpos%7D"><code><a href="../reference/input_cases.html">input_fracpos()</a></code></a>. Whether the data are by date-of-occurrence (e.g date of test specimen collection, date of death) or by date-of-report (e.g. daily updates to cumulative case and death counts) must be noted.</p>
<p>Because we use date-of-occurrence data, we choose to enable the ‘weekend effect.’ As individuals are less likely to be tested on Saturdays and Sundays, enabling the weekend effect allows the model to estimate a systematically lower probability of diagnosis on the weekend. This generally improves model fit to data when the data are by date-of-occurrence. For additional information about changing the base configuration of the model, see <a href="%5Ccode%7B?covidestim%7D"><code><a href="../reference/covidestim.html">covidestim()</a></code></a>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">config1</span> <span class="kw">&lt;-</span>
<span class="fu"><a href="../reference/covidestim.html">covidestim</a></span>(<span class="kw">ndays</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">df.cases</span>), <span class="kw">weekend</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
  <span class="fu"><a href="../reference/input_cases.html">input_cases</a></span>(<span class="no">df.cases</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"occurred"</span>) +
  <span class="fu"><a href="../reference/input_cases.html">input_deaths</a></span>(<span class="no">df.cases</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"occurred"</span>) +
  <span class="fu"><a href="../reference/input_cases.html">input_fracpos</a></span>(<span class="no">df.fracpos</span>)
<span class="no">config1</span>
<span class="co">#&gt; Covidestim Configuration:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Seed:    42</span>
<span class="co">#&gt; Chains:  3</span>
<span class="co">#&gt; Iterations:  1500</span>
<span class="co">#&gt; Warmup runs: 1200</span>
<span class="co">#&gt; Priors: Valid</span>
<span class="co">#&gt; ndays:   103</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Priors:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  log_new_inf_0_mu    0</span>
<span class="co">#&gt;  log_new_inf_0_sd    10</span>
<span class="co">#&gt;  deriv1_log_new_inf_sd   0.5</span>
<span class="co">#&gt;  deriv2_log_new_inf_sd   0.05</span>
<span class="co">#&gt;  p_sym_if_inf    [alpha] 44.9</span>
<span class="co">#&gt;  p_sym_if_inf    [beta]  9.9</span>
<span class="co">#&gt;  p_sev_if_sym    [alpha] 11.9</span>
<span class="co">#&gt;  p_sev_if_sym    [beta]  47.7</span>
<span class="co">#&gt;  p_die_if_sev    [alpha] 3</span>
<span class="co">#&gt;  p_die_if_sev    [beta]  97</span>
<span class="co">#&gt;  p_die_if_sym    [alpha] 1.12</span>
<span class="co">#&gt;  p_die_if_sym    [beta]  85.1</span>
<span class="co">#&gt;  inf_prg_delay   [shape] 5.202</span>
<span class="co">#&gt;  inf_prg_delay   [rate]  0.946</span>
<span class="co">#&gt;  sym_prg_delay   [shape] 5.147</span>
<span class="co">#&gt;  sym_prg_delay   [rate]  0.468</span>
<span class="co">#&gt;  sev_prg_delay   [shape] 2.383</span>
<span class="co">#&gt;  sev_prg_delay   [rate]  0.27</span>
<span class="co">#&gt;  cas_rep_delay_shp   [alpha] 2.2</span>
<span class="co">#&gt;  cas_rep_delay_shp   [beta]  1</span>
<span class="co">#&gt;  die_rep_delay_shp   [alpha] 2.2</span>
<span class="co">#&gt;  die_rep_delay_shp   [beta]  1</span>
<span class="co">#&gt;  p_diag_if_sym   [alpha] 2</span>
<span class="co">#&gt;  p_diag_if_sym   [beta]  2</span>
<span class="co">#&gt;  p_diag_if_sev   [alpha] 1.5</span>
<span class="co">#&gt;  p_diag_if_sev   [beta]  1</span>
<span class="co">#&gt;  weekend_eff [alpha] 2</span>
<span class="co">#&gt;  weekend_eff [beta]  2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Inputs:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  [ 103]  Cases</span>
<span class="co">#&gt;  [ 103]  Deaths</span>
<span class="co">#&gt;  [ 103]  Fraction positive</span></pre></body></html></div>
</div>
<div id="initializing-a-model-run" class="section level3">
<h3 class="hasAnchor">
<a href="#initializing-a-model-run" class="anchor"></a>Initializing a model run</h3>
<p>Finally, the model is run with the call <a href="%5Ccode%7B?run%7D"><code>run</code></a>. Do not forget to assign the a name to the output of the run. Runtimes vary depending on the size and quality of the data, and may take over an hour. If you are running the model in RStudio, periodic status updates will appear in the console.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">output</span> <span class="kw">&lt;-</span> <span class="fu">run</span>(<span class="no">config1</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="kw pkg">parallel</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span>())</pre></body></html></div>
</div>
</div>
<div id="accessing-model-output" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-model-output" class="anchor"></a>Accessing model output</h2>
<p>Calling <code>run()</code> on a valid covidestim configuration will produce a S3 object of class <code>covidestim_result</code>. Here, we describe the summary functions in covidestim to view model results. In the vignette <a href="https://www.covidestim.org/articles/covidestim_vignette.html">Acessing Covidestim Results Object</a> we describe the various items within <code>covidestim_result</code>.</p>
<div id="summarizing-covidestim-output" class="section level3">
<h3 class="hasAnchor">
<a href="#summarizing-covidestim-output" class="anchor"></a>Summarizing covidestim output</h3>
<p>A covidestim object can be easily converted to a summary data frame with the call <a href="%5Ccode%7B?summary%7D"><code>summary</code></a>. Each row of the data frame is a date. Each column of the data frame is a value of interest. Variables appened with .hi or .lo indicate the 0.975 and 0.025 quantiles, respectively. A data dictionary for summarized results can be found <a href="%5Ccode%7B?summary%7D">here</a>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">output.summary</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">output</span>)</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">output.summary</span>[<span class="fl">40</span>:<span class="fl">45</span>, <span class="fl">1</span>:<span class="fl">5</span>])
<span class="co">#&gt; Error in print(output.summary[40:45, 1:5]): object 'output.summary' not found</span></pre></body></html></div>
<p>The posterior distributions of key time-invariant parameters can also be summarized with the call <a href="?code%7B?summaryEpi%7D"><code>summaryEpi</code></a></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="kw pkg">covidestim</span><span class="kw ns">::</span><span class="fu"><a href="../reference/summaryEpi.html">summaryEpi</a></span>(<span class="no">output</span>)
<span class="co">#&gt; Error in rstan::summary(ccr$result, pars = pars_of_interest, probs = c(0.025, : object 'output' not found</span></pre></body></html></div>
<p>Note that p_diag_if_sym (the probability a symptomatic case is diagnosed) and p_diag_if_sev (the probability that a severe case is diagnosed) are summarized without the adjustment for changing diagnostic coverage.</p>
</div>
</div>
<div id="visualizing-model-output" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-model-output" class="anchor"></a>Visualizing model output</h2>
<p>Model results can be visualized with a the call <a href="%5Ccode%7B?viz%7D"><code>viz</code></a>. Three figures will be produced:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">visual</span> <span class="kw">&lt;-</span> <span class="kw pkg">covidestim</span><span class="kw ns">::</span><span class="fu">viz</span>(<span class="no">output</span>)</pre></body></html></div>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary.default</a></span>(<span class="no">visual</span>)
<span class="co">#&gt;                    Length Class Mode</span>
<span class="co">#&gt; observedVsFitted   9      gg    list</span>
<span class="co">#&gt; infectionsAndCases 9      gg    list</span>
<span class="co">#&gt; RtEstim            9      gg    list</span></pre></body></html></div>
<p>The figure ‘observedVsFitted’ plots the observed cases and deaths (the input data) against the modeled values for reported cases and deaths. In the plot bellow, note that the effect of weekends on detection and reporting can be clearly observed in both the input data and in the model output.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">visual</span>$<span class="no">observedVsFitted</span></pre></body></html></div>
<div class="figure">
<img src="figure/Rplot001.png" alt=""><p class="caption">plot of fig 12</p>
</div>
<p>The figure ‘infectionsAndCases’ plots modeled reported cases against modeled ‘true’ new infections. The latter is what we estimate to be the complete, un-lagged time series of incident infections that would give rise to the trends we observe in the case and death data.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">visual</span>$<span class="no">infectionsAndCases</span></pre></body></html></div>
<div class="figure">
<img src="figure/Rplot002.png" alt=""><p class="caption">plot of fig 2</p>
</div>
<p>Finlly, ‘RtEstim’ is the estimated effective reproduction number (Rt) based on the modeled time series of new infections. These estimates are produced using the <a href="https://cran.r-project.org/web/packages/EpiEstim/index.html">EpiEstim package for R</a>. We use a five-day moving average. Values are plotted on the middle day of the moving average (e.g. the Rt estimate for March 16 is the average Rt over the period March 14 - March 18).</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">visual</span>$<span class="no">RtEstim</span></pre></body></html></div>
<div class="figure">
<img src="figure/Rplot003.png" alt=""><p class="caption">plot of fig 3</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marcus Russi, Melanie Chitwood.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
